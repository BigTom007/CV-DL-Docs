# Unsupervised Domain-Specific Deblurring via Disentangled Representations

图像去模糊的目的是从对应的模糊图像复原图像的隐含形状。本文提出一种基于解耦表示的，用于特定域的单张图像去模糊的无监督方法。通过使用内容编码器和模糊编码器分离一张模糊图像的内容和模糊特征，从而实现解耦。采用KL散度loss用于正则化提取的模糊属性的分布区间，从而保证只包含很少的内容信息。同时，为了解决不成对数据，加入模糊分支和循环一致性loss以确保去模糊结果的内容结构域原始图像吻合。还在去模糊的结果上加入一个对抗loss，用来生成视觉上真实的图片，加入一个感知（perceptual）loss，进一步削弱人工痕迹。

![Figure 1](1.png"Figure 1")

## 1. Introduction

为了解决图像模糊问题，blind image 去模糊的目标是从对应的模糊图像复原图像的隐含形状。大多数传统方法将图像去模糊任务视为一个模糊核估计问题。由于这一问题有严重的不适定性，提出了很多方法来对图像和核进行建模。但是大多数方法只在一般的自然图片上的表现尚可，对于特定域的图像，如人脸，文字核低光照图片等就无法泛化。于是出现了一些用于特定域图像去模糊的方法。但是这些方法仍然只能解决特定类型的模糊，而且一般需要较长推理时间。

最近一些基于学习的方法用于blind image 去模糊。基于CNN的模型可以解决更复杂的模糊类型而且其容量足够大，可以在大尺度数据集上进行训练。同时，GAN被发现可以生成更真实图片。但是这些方法都需要成对的训练数据，获取成本较高。尽管很多模糊生成的方法被开发出来，到那时它们并不能学习现实场景下所有类别的模糊变体。而且强监督会引起算法过拟合，从而无法泛化。

![Figure 2](2.png"Figure 2")

本文提出一种基于解耦表示的，无监督的特定域图像去模糊方法。具体来说，将模糊图像的内容和模糊特征解耦，以精准编码模糊信息到去模糊框架中。如Figure 2所示，内容编码器从未成对的清晰与模糊图片提取内容特征，模糊编码器提取模糊信息。两个编码器共享最后层的权重，这样内容编码器就可以将两个域的内容特征投影到一个一般空间。但是如果只使用这个架构，无法确保模糊编码器能够捕捉模糊特征，它也许会编码内容信息。加入一个KL散度loss用于正则化模糊特征的分布来压制其包含的内容信息。然后去模糊生成器$G_S$和模糊生成器$G_B$接收对应模糊属性下的内容特征用于生成去模糊图片和模糊图片。和CycleGan类似，同样使用对抗loss和循环一致性loss来帮助生成器网络获取更多显示图片，同时保留原始图片的内容。为了进一步去除生成器$G_S$引入的令人讨厌的人工痕迹，在框架中加入感知loss，一些去模糊后的样本见Figure 1



## 2. Related Works

### 2.1. Single Images Blind Deblurring

**Generic methods:** 单张图片blind deblurring是一个高度不适定问题。过去十年间，出现了一些自然图像和核先验的方法用来正则化隐含清晰图像的解空间，包括重尾梯度先验，稀疏核先验，$l_0$梯度先验，标准化稀疏性先验和暗通道法。但是这些先验建立的基础是有限的观察集，它们不够准确。就导致去模糊后的图像通常要么未完全去模糊（图片仍然模糊），要么过度去模糊（图片包含太多人为因素）。

另一方面，由于最近深度网络和GAN的巨大成功，一些基于CNN的方法被提出用于图片去模糊。

**Domain specific methods:** 尽管上述方法对自然图片的去模糊效果不错，却很难将它们泛化到一些特定图像域，例如人脸和文字图片。

### 2.2. Disentangled Representation

最近在解耦表示方向上有些努力。最近一些无监督方法将图像解耦成域不变内容特征和域特定属性向量，生成不同的图片到图片的变换输出。



## 3. Proposed Method

提出的框架由四部分组成：

1）内容编码器$E_B^c$和$E_S^c$用于对模糊和清晰图片域；

2）模糊编码器$E^b$

3）模糊和清晰图像生成器$G_B$和$G_S$

4）模糊和清晰图像判别器$D_B$和$D_S$

给定一个训练样本$b\in B$属于模糊图像域，和$s\in S$属于清晰图像域，内容编码器$E_B^c$和$E_S^c$从对应样本提起内容信息，$E^b$从$b$估计模糊信息。然后$G_S$使用$E_B^c(b)$和$E^b(b)$生成一张清晰图片$s_b$，同时$G_B$使用$E_S^c(s)$和$E^b(b)$生成一张模糊图像$b_s$. 判别器$D_B$和$D_S$区分真实样本和生成样本。端到端的架构如Figure 2所示

### 3.1. Disentanglement of Content and Blur

由于在非配对条件下无法获得gt清晰图片，从一张模糊图片种解耦出内容信息就很重要（非小事，not trivial）。但是由于清晰图片只包含内容组成而没有任何模糊信息，内容编码器$E_S^c$应该是一个好的内容提取器。我们强制编码器$E_B^c$和$E_S^c$共享最后一层的权重，目的是引导$E_B^c$学习如何从模糊图像种高效地提取内容信息。

另一方面，模糊编码器$E^b$应该只编码模糊信息。为了达成这一目的，提出两个方法来帮助$E^b$尽可能地一致内容信息。首先，将$E_S^c(s)$和$E^b(b)$传入$G_B$生成$b_s$. 由于$b_s$是$s$的模糊版本，其并不包含$b$的内容信息，这个结构阻止$E^b(b)$编码$b$的内容信息。其次，加入一个KL散度loss