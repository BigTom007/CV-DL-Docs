# SER-FIQ: Unsupervised Estimation of Face Image Quality Based on Stochastic Embedding Robustness

基于随机嵌入鲁棒性的无监督人脸质量估计

提议使用一张图片表达的鲁棒性作为质量线索。

***Abstract***

人脸图像质量是实现高质量人脸识别系统的一个重要的因素。人脸质量评估的目的在于估计一张人脸图片适合用于识别的程度。之前的方法使用有监督方案，需要人工标注质量值。但是这样的标注机制容易出错，因为并没有对质量水平的一个明确定义，也无法知道使用的人脸识别系统的最好特性。为了避免使用不准确的质量标签，我们提出一个新的基于任意人脸识别模型的概念来衡量人脸质量。通过判定一个人脸模型的随机子网络生成的embedding差异，一个样本表达的鲁棒性，因此可以估计其质量。



## 1. INTRODUCTION

由于大众接受程度较高且不需要用户主动配合，人脸图像是使用最多的生物识别模式之一。对于受控场景，当前的人脸识别系统能达到高准确率的表现。但是一些最有价值的人脸识别系统是在非限制环境下工作，因此需要解决较大差异引起的识别准确率的下降。这些差异包括照片拍摄的状态（如光照情况、背景、模糊和低分辨率），人脸因素（如姿态、遮挡和表情）和部署的人脸识别系统本身的偏差。因为这些差异会导致识别效果大幅度下降，则需要提出解决办法。

生物识别的效果由其样本质量决定。生物样本的质量定义为为了识别目的的样本使用。在进行匹配前自动预测人脸质量对于很多应用来说都是有益的。这样人脸识别系统的注册会更健壮。在否定性鉴别系统中，可以防止攻击者通过提供一张低质量图片来入侵系统。而且可以在提供多张图片或多个生物模式的前提下实现基于质量的融合。

当前人脸质量评估的解决方案需要带质量标签的训练数据，标签来源于人脸视角或来源于对照评分。这种质量评估衡量标准的定义是不明确的。人类也许并不知道所使用的人脸识别系统最好的特性是什么。另一方面，基于分数对比的自动标签代表两个样本的相关性，因此一个低质量的样本也许会对另一个样本的质量标签产生负面影响。

本文通过调查随机embeddings的鲁棒性提出一个新的无监督人脸质量评估概念。我们的方法在其embedding空间上基于其鲁棒性衡量一张图片的质量。

Figure 1展示了其工作原理

![Figure 1](1.png"Figure 1")



## 2. Related work

为了保证人脸图像质量提出了一些标准。这些标准中，质量分为基于图像的质量（如姿态，表情，光照，遮挡）和基于对物体的质量（如配件）。这些标准影响了很多近些年提出的人脸质量评估方法。

基于图像质量因素分析的方法定义了人脸不对称性的质量度量，提出竖直边缘密度作为一项质量的衡量指标来获取姿态的变化信息，或在亮度失真与一张已知图片做对比进行衡量。但是这些方法需要人为地考虑每一个可能的因素，由于人类也许无法得知人脸识别系统最好的特性，最近更多的研究关注基于学习的方法。



## 3. Our approach

人脸质量评估的目的是估计一张人脸图像对于人脸识别的适用程度。一张人脸图像的质量应该与其应有的识别效果相对应。本作中，我们的人脸图片质量的定义以对应图片的深度学习embedding为基础。计算一个人脸识别模型的随机的子网络输出的embeddings的差异，我们的方法将这些差异的量级定义为一个鲁棒的度量，亦即图像质量。Figure 2展示了这一方法。

![Figure 2](2.png"Figure 2")

### 3.1. Sample-quality estimation

我们的方法使用一个人脸识别模型$\mathcal{M}$来预测给定人脸图像$I$的人脸质量$Q(I)$. 人脸识别模型需要使用dropout训练且其目的为提取能够良好区分id的embedding特征。为了获得$I$的基于鲁棒性的质量估计，在$\mathcal{M}$上通过使用不同dropout模式的随机前向传播生成$m=100$个随机embedding特征。$m$的选择取决于时间复杂度和质量衡量稳定性间的trade-off. 每一次随机前向传播都应用一个不同的dropout模式（预测期间）生成$\mathcal{M}$的一个子网络。每一个子网络生成人脸的一个随机embedding向量$x_s$.这些随机embedding向量放到一个集合中$X(I)=\{x_s\}_{s\in\{1,2,...,m\}}$. 我们将图像$I$对应的人脸质量定义为全部embedding向量对间的负的平均欧几里得距离$d(x_i,x_j)$的sigmoid值，$(x_i,x_j)\in X \times X$. 
$$
q(X(I))=2\sigma\bigg(-\frac{2}{m^2}\sum\limits_{i<j}d(x_i,x_j)\bigg), \quad\quad\quad(1)
$$


sigmoid函数$\sigma(\cdot)$保证$q\in[0,1]$.

由于已经证明在一个网络上重复使用dropout可以近似高斯过程的不确定性，则欧几里得距离是计算$d(x_i,x_j)$的一个合适的选择。随机embedding向量集合$X$的差异较大意味着表达的鲁棒性较差，也就代表低样本质量$q$. $X$中较低的差异意味着在embedding空间中有较高的鲁棒性，可以认为是高样本质量$q$. Algorithm 1展示了质量预测策略

![Algorithm 1](a1.png"Algorithm 1")



### 3.2. Properties

SER-FIQ的目标是从识别任务的视角来估计人脸图片的质量，也许和估计图片质量的视角不一样。一张图片如果不受多种差异影响（这里由dropout引起）能够生成相对稳定的与id对应的embedding特征向量，那么它就是一张在识别任务中有较高可用性的图片，前提是识别网络训练目标是在类内鲁棒。

人脸识别算法训练的目标是学习到鲁棒的表示来增加类间距，降低类内距。假设一个人脸识别网络使用dropout训练且一个样本的质量与其embedding特征的鲁棒性相关，不同子网络可以从基础模型通过处理不同dropout模式生成。子网络间的一致性可以用于估计embedding特征的鲁棒性，因此也可用于估计质量。如果$m$个子网络生成相似的输出（高一致性），则这些子网络之间的差异（随机embedding特征集合$X$）就小。因此，这个embedding特征的鲁棒性，亦即这个样本的质量就高。相反，如果$m$个子网络生成不相似的表达（低一致性），随机子网络的差异就大。因此embedding空间的鲁棒性就低，样本质量也可以认为是低的。

我们的方法只有一个参数$m$，随机前向传播的数量。这个参数可以解释为一个蒙特卡洛模拟的步数，并控制质量预测的稳定性。较大的$m$可以得到更稳定的质量估计。由于本方法的计算时间$t=O(m^2)$根据$m$是平方增长的，因此取值不应过大。但是我们的方法可以抵消这一问题，并能实时运行，因为它是高度并行的，而且可以通过仅在最后几层重复随机前向传播过程大幅度降低计算量。

与之前的方法相比，我们的方法训练时不需要质量标签。而且如果使用的人脸识别系统训练时用到dropout，则可使用同一个网络判定embedding特征的鲁棒性，也就是样本质量。这样做的好处是可以完全避免训练而且质量预测捕获正在使用的人脸识别模型的决策模式和偏置。因此强烈推荐使用部署的人脸识别模型做质量评估任务。



## 4. Experimental setup

**Databases**

三个公开数据集：ColorFeret（1199个id的14126张高分辨率人脸图像，限制场景），Adience（2284个id的26580张图像，非限制场景）和LFW（5749个id的13233张图像）。后两个包含包括光照、位置、对焦、模糊、姿态和遮挡等在内的大量差异。

**Evaluation metrics**

